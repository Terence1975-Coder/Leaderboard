<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Prompt Architect</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #581c87 50%, #0f172a 100%);
            min-height: 100vh;
            color: #e2e8f0;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(15, 23, 42, 0.9) 100%);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            border: 1px solid rgba(71, 85, 105, 0.5);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .header-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #06b6d4, #8b5cf6);
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .header-icon::after {
            content: '';
            position: absolute;
            top: -2px;
            right: -2px;
            width: 12px;
            height: 12px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .title {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(90deg, #22d3ee, #a855f7, #10b981);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #cbd5e1;
            font-size: 1.1rem;
        }

        .tagline {
            text-align: center;
            padding: 1rem;
            background: linear-gradient(90deg, rgba(139, 92, 246, 0.3), rgba(6, 182, 212, 0.3));
            border-radius: 0.75rem;
            border: 1px solid rgba(139, 92, 246, 0.2);
            margin-top: 1rem;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(15, 23, 42, 0.9) 100%);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            border: 1px solid rgba(71, 85, 105, 0.5);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .label {
            display: block;
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .input, .textarea, .select {
            width: 100%;
            padding: 0.75rem;
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid #475569;
            border-radius: 0.5rem;
            color: #e2e8f0;
            backdrop-filter: blur(5px);
            transition: all 0.3s;
        }

        .input:focus, .textarea:focus, .select:focus {
            outline: none;
            border-color: #06b6d4;
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
        }

        .textarea {
            resize: vertical;
            min-height: 120px;
            font-family: inherit;
        }

        .textarea.large {
            min-height: 250px;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.5rem;
            max-height: 150px;
            overflow-y: auto;
            padding: 0.75rem;
            background: rgba(30, 41, 59, 0.3);
            border: 1px solid #475569;
            border-radius: 0.5rem;
            backdrop-filter: blur(5px);
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .checkbox-item:hover {
            background: rgba(71, 85, 105, 0.3);
        }

        .checkbox {
            accent-color: #06b6d4;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(90deg, #06b6d4, #8b5cf6);
            color: white;
            width: 100%;
            padding: 1rem;
            font-size: 1rem;
        }

        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(90deg, #0891b2, #7c3aed);
            transform: translateY(-1px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .btn-primary:disabled {
            background: linear-gradient(90deg, #475569, #64748b);
            cursor: not-allowed;
        }

        .btn-secondary {
            background: rgba(71, 85, 105, 0.5);
            color: #cbd5e1;
            border: 1px solid #475569;
        }

        .btn-secondary:hover {
            background: rgba(71, 85, 105, 0.7);
        }

        .btn-success {
            background: linear-gradient(90deg, #10b981, #059669);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background: linear-gradient(90deg, #059669, #047857);
        }

        .btn-danger {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, 0.5);
        }

        .btn-small {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }

        .flex {
            display: flex;
        }

        .flex-between {
            justify-content: space-between;
        }

        .flex-center {
            justify-content: center;
        }

        .items-center {
            align-items: center;
        }

        .gap-2 {
            gap: 0.5rem;
        }

        .gap-4 {
            gap: 1rem;
        }

        .text-center {
            text-align: center;
        }

        .text-sm {
            font-size: 0.875rem;
        }

        .text-xs {
            font-size: 0.75rem;
        }

        .text-cyan {
            color: #22d3ee;
        }

        .text-slate {
            color: #94a3b8;
        }

        .mb-2 {
            margin-bottom: 0.5rem;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        .mt-2 {
            margin-top: 0.5rem;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .library {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(15, 23, 42, 0.9) 100%);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            border: 1px solid rgba(71, 85, 105, 0.5);
            padding: 2rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .library-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .library-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #10b981, #06b6d4);
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .library-title {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(90deg, #10b981, #22d3ee);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .prompt-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .prompt-card {
            background: rgba(30, 41, 59, 0.4);
            border: 1px solid rgba(71, 85, 105, 0.5);
            border-radius: 0.5rem;
            padding: 1rem;
            transition: all 0.3s;
        }

        .prompt-card:hover {
            border-color: #06b6d4;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .prompt-title {
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 0.5rem;
        }

        .prompt-preview {
            color: #cbd5e1;
            font-size: 0.875rem;
            margin-bottom: 0.75rem;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }

        .modal-content {
            background: #1e293b;
            border: 1px solid #475569;
            border-radius: 0.75rem;
            padding: 1.5rem;
            max-width: 500px;
            width: 100%;
        }

        .modal-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 1rem;
        }

        .hidden {
            display: none;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #94a3b8;
        }

        .empty-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 1rem;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="header-icon">
                    <i data-lucide="brain" style="color: white; width: 32px; height: 32px;"></i>
                </div>
                <div>
                    <h1 class="title">AI Prompt Architect</h1>
                    <p class="subtitle">Craft intelligent prompts with precision and creativity</p>
                </div>
            </div>
            
            <div class="tagline">
                <p style="font-size: 1.1rem; font-weight: 600; background: linear-gradient(90deg, #22d3ee, #10b981); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                    ✨ "Prompting like an expert is your AI superpower" ✨
                </p>
            </div>
        </div>

        <!-- Main Form -->
        <div class="main-grid">
            <!-- Input Column -->
            <div>
                <div class="form-group">
                    <label class="label">Request Description *</label>
                    <textarea id="request" class="textarea" placeholder="Describe what you want the AI to do..."></textarea>
                </div>

                <div class="form-group">
                    <label class="label">Personas (Select multiple)</label>
                    <div class="checkbox-grid" id="personas-grid">
                        <!-- Generated by JS -->
                    </div>
                </div>

                <div class="form-group">
                    <label class="label">Guidelines & Limitations</label>
                    <div class="checkbox-grid" id="limitations-grid">
                        <!-- Generated by JS -->
                    </div>
                </div>

                <div class="grid-2">
                    <div class="form-group">
                        <label class="label">Tone</label>
                        <select id="tone" class="select">
                            <option value="">Select tone...</option>
                            <option value="Professional">Professional</option>
                            <option value="Casual">Casual</option>
                            <option value="Academic">Academic</option>
                            <option value="Creative">Creative</option>
                            <option value="Persuasive">Persuasive</option>
                            <option value="Analytical">Analytical</option>
                            <option value="Humorous">Humorous</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="label">Output Format</label>
                        <select id="outputFormat" class="select">
                            <option value="">Select format...</option>
                            <option value="Paragraph">Paragraph</option>
                            <option value="Bullet Points">Bullet Points</option>
                            <option value="Numbered List">Numbered List</option>
                            <option value="Table">Table</option>
                            <option value="Step-by-step">Step-by-step</option>
                            <option value="Q&A">Q&A</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="label">Additional Context (Optional)</label>
                    <textarea id="context" class="textarea" style="min-height: 80px;" placeholder="Provide any additional context or background information..."></textarea>
                </div>

                <div class="form-group">
                    <label class="label">Examples (Optional)</label>
                    <textarea id="examples" class="textarea" style="min-height: 80px;" placeholder="Provide examples of desired output or style..."></textarea>
                </div>

                <div class="form-group">
                    <label class="label">Word Limit</label>
                    <div class="flex items-center gap-4">
                        <input type="number" id="wordLimit" class="input" placeholder="e.g., 500" style="flex: 1;">
                        <label class="flex items-center gap-2" style="cursor: pointer;">
                            <input type="checkbox" id="noWordLimit" class="checkbox">
                            <span class="text-sm">No limit</span>
                        </label>
                    </div>
                </div>

                <button id="generateBtn" class="btn btn-primary">
                    <i data-lucide="zap" style="width: 20px; height: 20px;"></i>
                    Create Prompt
                </button>

                <div id="apiKeyPrompt" class="text-center mt-2">
                    <p class="text-sm text-slate mb-2">Want AI-enhanced prompts?</p>
                    <button id="showApiKeyBtn" class="text-cyan text-sm" style="background: none; border: none; text-decoration: underline; cursor: pointer;">
                        Add OpenAI API Key
                    </button>
                </div>
            </div>

            <!-- Output Column -->
            <div id="outputColumn" class="hidden">
                <div class="form-group">
                    <div class="flex flex-between items-center mb-2">
                        <label class="label">Generated Prompt</label>
                        <div class="flex gap-2">
                            <button id="refineBtn" class="btn btn-secondary btn-small hidden">
                                <i data-lucide="zap" style="width: 16px; height: 16px;"></i>
                                AI Refine
                            </button>
                            <button id="copyBtn" class="btn btn-secondary btn-small">
                                <i data-lucide="copy" style="width: 16px; height: 16px;"></i>
                                Copy
                            </button>
                        </div>
                    </div>
                    <textarea id="generatedPrompt" class="textarea large"></textarea>
                </div>

                <div class="form-group">
                    <label class="label">Save to Library</label>
                    <div class="flex gap-2 mb-4">
                        <input id="promptTitle" class="input" placeholder="Enter prompt title..." style="flex: 1;">
                        <button id="saveBtn" class="btn btn-success">
                            <i data-lucide="save" style="width: 16px; height: 16px;"></i>
                            Save
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="label">Launch with AI Platform</label>
                    <div class="flex gap-2">
                        <select id="aiPlatform" class="select" style="flex: 1;">
                            <option value="ChatGPT">🤖 ChatGPT</option>
                            <option value="Claude">🧠 Claude</option>
                            <option value="Gemini">💎 Gemini</option>
                            <option value="Perplexity">🔍 Perplexity</option>
                            <option value="Copilot">🚁 Copilot</option>
                            <option value="Poe">📝 Poe</option>
                        </select>
                        <button id="launchBtn" class="btn" style="background: linear-gradient(90deg, #8b5cf6, #ec4899); color: white; font-weight: 600;">
                            🚀 Launch
                        </button>
                    </div>
                    <p class="text-xs text-slate mt-2">
                        Prompt will be copied to clipboard and the AI platform will open in a new tab
                    </p>
                </div>
            </div>
        </div>

        <!-- Library -->
        <div class="library">
            <div class="library-header">
                <div class="library-icon">
                    <i data-lucide="book-open" style="color: white; width: 24px; height: 24px;"></i>
                </div>
                <h2 class="library-title">Prompt Library</h2>
            </div>

            <div id="libraryContent">
                <div class="empty-state">
                    <div class="empty-icon">
                        <i data-lucide="book-open" style="width: 64px; height: 64px; color: #64748b;"></i>
                    </div>
                    <p>No prompts found. Create your first prompt above!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- API Key Modal -->
    <div id="apiKeyModal" class="modal hidden">
        <div class="modal-content">
            <h3 class="modal-title">Enter OpenAI API Key</h3>
            <p class="text-sm text-slate mb-4">
                To use prompt enhancement and refinement, please enter your OpenAI API key. 
                It will be stored locally in your browser.
            </p>
            <input type="password" id="apiKeyInput" class="input mb-4" placeholder="sk-...">
            <div class="flex gap-2">
                <button id="saveApiKeyBtn" class="btn btn-primary" style="flex: 1;">Save & Use</button>
                <button id="cancelApiKeyBtn" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Application State
        let state = {
            selectedPersonas: [],
            selectedLimitations: [],
            promptLibrary: [],
            apiKey: '',
            isGenerating: false,
            isRefining: false
        };

        // Constants
        const PERSONAS = [
            'Expert Writer', 'Data Analyst', 'Creative Designer', 'Business Consultant',
            'Technical Expert', 'Marketing Specialist', 'Research Assistant', 'Content Creator',
            'Project Manager', 'Strategic Advisor'
        ];

        const LIMITATIONS = [
            'Keep it concise', 'Use simple language', 'Avoid technical jargon',
            'Include specific examples', 'Focus on actionable insights', 'Maintain professional tone'
        ];

        const AI_PLATFORMS = {
            'ChatGPT': 'https://chat.openai.com/',
            'Claude': 'https://claude.ai/',
            'Gemini': 'https://gemini.google.com/',
            'Perplexity': 'https://www.perplexity.ai/',
            'Copilot': 'https://copilot.microsoft.com/',
            'Poe': 'https://poe.com/'
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            initializePersonas();
            initializeLimitations();
            loadFromStorage();
            setupEventListeners();
        });

        function initializePersonas() {
            const grid = document.getElementById('personas-grid');
            grid.innerHTML = '';
            
            PERSONAS.forEach(persona => {
                const div = document.createElement('div');
                div.className = 'checkbox-item';
                div.innerHTML = '<input type="checkbox" class="checkbox" data-persona="' + persona + '">' +
                               '<span class="text-sm">' + persona + '</span>';
                grid.appendChild(div);
            });
        }

        function initializeLimitations() {
            const grid = document.getElementById('limitations-grid');
            grid.innerHTML = '';
            
            LIMITATIONS.forEach(limitation => {
                const div = document.createElement('div');
                div.className = 'checkbox-item';
                div.innerHTML = '<input type="checkbox" class="checkbox" data-limitation="' + limitation + '">' +
                               '<span class="text-sm">' + limitation + '</span>';
                grid.appendChild(div);
            });
        }

        function loadFromStorage() {
            try {
                const savedLibrary = localStorage.getItem('promptLibrary');
                if (savedLibrary) {
                    state.promptLibrary = JSON.parse(savedLibrary);
                    renderLibrary();
                }

                const savedApiKey = localStorage.getItem('openai_api_key');
                if (savedApiKey) {
                    state.apiKey = savedApiKey;
                    updateApiKeyUI();
                }
            } catch (error) {
                console.error('Error loading from storage:', error);
            }
        }

        function setupEventListeners() {
            // Form inputs
            document.getElementById('noWordLimit').addEventListener('change', function() {
                document.getElementById('wordLimit').disabled = this.checked;
            });

            // Persona checkboxes
            document.getElementById('personas-grid').addEventListener('change', function(e) {
                if (e.target.type === 'checkbox') {
                    const persona = e.target.dataset.persona;
                    if (e.target.checked) {
                        state.selectedPersonas.push(persona);
                    } else {
                        state.selectedPersonas = state.selectedPersonas.filter(p => p !== persona);
                    }
                }
            });

            // Limitation checkboxes
            document.getElementById('limitations-grid').addEventListener('change', function(e) {
                if (e.target.type === 'checkbox') {
                    const limitation = e.target.dataset.limitation;
                    if (e.target.checked) {
                        state.selectedLimitations.push(limitation);
                    } else {
                        state.selectedLimitations = state.selectedLimitations.filter(l => l !== limitation);
                    }
                }
            });

            // Buttons
            document.getElementById('generateBtn').addEventListener('click', generatePrompt);
            document.getElementById('copyBtn').addEventListener('click', () => copyToClipboard(document.getElementById('generatedPrompt').value));
            document.getElementById('refineBtn').addEventListener('click', refinePrompt);
            document.getElementById('saveBtn').addEventListener('click', saveToLibrary);
            document.getElementById('launchBtn').addEventListener('click', launchWithAI);
            document.getElementById('showApiKeyBtn').addEventListener('click', () => showModal('apiKeyModal'));
            document.getElementById('saveApiKeyBtn').addEventListener('click', saveApiKey);
            document.getElementById('cancelApiKeyBtn').addEventListener('click', () => hideModal('apiKeyModal'));
        }

        function generatePrompt() {
            const request = document.getElementById('request').value.trim();
            if (!request) {
                alert('Please enter a request description');
                return;
            }

            state.isGenerating = true;
            updateGenerateButton();

            // Build basic prompt
            const components = [];
            
            if (state.selectedPersonas.length > 0) {
                components.push('Acting as: ' + state.selectedPersonas.join(', '));
            }
            
            components.push('Task: ' + request);
            
            const context = document.getElementById('context').value.trim();
            if (context) {
                components.push('Context: ' + context);
            }
            
            const tone = document.getElementById('tone').value;
            if (tone) {
                components.push('Tone: ' + tone);
            }
            
            const outputFormat = document.getElementById('outputFormat').value;
            if (outputFormat) {
                components.push('Format: ' + outputFormat);
            }
            
            if (state.selectedLimitations.length > 0) {
                components.push('Guidelines: ' + state.selectedLimitations.join(', '));
            }
            
            const examples = document.getElementById('examples').value.trim();
            if (examples) {
                components.push('Examples: ' + examples);
            }
            
            const noWordLimit = document.getElementById('noWordLimit').checked;
            const wordLimit = document.getElementById('wordLimit').value;
            if (!noWordLimit && wordLimit) {
                components.push('Word limit: ' + wordLimit + ' words');
            }
            
            const basicPrompt = components.join('\n\n');

            // Try to enhance with API if available
            if (state.apiKey) {
                enhanceWithAPI(basicPrompt).then(enhanced => {
                    document.getElementById('generatedPrompt').value = enhanced;
                    showOutput();
                    state.isGenerating = false;
                    updateGenerateButton();
                }).catch(error => {
                    console.error('Enhancement failed:', error);
                    document.getElementById('generatedPrompt').value = basicPrompt;
                    showOutput();
                    state.isGenerating = false;
                    updateGenerateButton();
                });
            } else {
                document.getElementById('generatedPrompt').value = basicPrompt;
                showOutput();
                state.isGenerating = false;
                updateGenerateButton();
            }
        }

        async function enhanceWithAPI(basicPrompt) {
            const enhancementRequest = 'Please enhance and expand this AI prompt to make it more detailed, specific, and effective. Add clear instructions, better structure, and specific guidance that will help get superior results from AI models:\n\n"' + basicPrompt + '"\n\nMake it comprehensive and professional while maintaining the original intent. Include specific examples, constraints, and detailed instructions.';

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + state.apiKey
                },
                body: JSON.stringify({
                    model: 'gpt-3.5-turbo',
                    messages: [
                        {
                            role: 'system',
                            content: 'You are an expert prompt engineer. Your job is to enhance and expand AI prompts to make them more effective, detailed, and comprehensive.'
                        },
                        {
                            role: 'user',
                            content: enhancementRequest
                        }
                    ],
                    max_tokens: 1500,
                    temperature: 0.7
                })
            });

            if (!response.ok) {
                throw new Error('API request failed');
            }

            const data = await response.json();
            return data.choices[0].message.content;
        }

        async function refinePrompt() {
            if (!state.apiKey) {
                showModal('apiKeyModal');
                return;
            }

            state.isRefining = true;
            updateRefineButton();

            const currentPrompt = document.getElementById('generatedPrompt').value;
            
            try {
                const refinementRequest = 'Please refine and improve this AI prompt to make it more effective, clear, and comprehensive. Add specific instructions, examples, and structure that will help get better results from AI models:\n\n"' + currentPrompt + '"\n\nMake it more professional and detailed while maintaining the original intent.';

                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + state.apiKey
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            {
                                role: 'system',
                                content: 'You are an expert prompt engineer. Your job is to refine and improve AI prompts to make them more effective, clear, and comprehensive.'
                            },
                            {
                                role: 'user',
                                content: refinementRequest
                            }
                        ],
                        max_tokens: 1000,
                        temperature: 0.7
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('generatedPrompt').value = data.choices[0].message.content;
                } else {
                    throw new Error('API request failed');
                }
            } catch (error) {
                console.error('Error refining prompt:', error);
                alert('Error refining prompt. Please check your API key and try again.');
            } finally {
                state.isRefining = false;
                updateRefineButton();
            }
        }

        function updateGenerateButton() {
            const btn = document.getElementById('generateBtn');
            if (state.isGenerating) {
                const text = state.apiKey ? 'AI Enhancing...' : 'Generating...';
                btn.innerHTML = '<div class="spinner"></div>' + text;
                btn.disabled = true;
            } else {
                const text = state.apiKey ? 'Create & Enhance with AI' : 'Create Prompt';
                btn.innerHTML = '<i data-lucide="zap" style="width: 20px; height: 20px;"></i>' + text;
                btn.disabled = false;
                lucide.createIcons();
            }
        }

        function updateRefineButton() {
            const btn = document.getElementById('refineBtn');
            if (state.isRefining) {
                btn.innerHTML = '<div class="spinner"></div>Refining...';
                btn.disabled = true;
            } else {
                btn.innerHTML = '<i data-lucide="zap" style="width: 16px; height: 16px;"></i>AI Refine';
                btn.disabled = false;
                lucide.createIcons();
            }
        }

        function showOutput() {
            document.getElementById('outputColumn').classList.remove('hidden');
        }

        function updateApiKeyUI() {
            const hasApiKey = state.apiKey && state.apiKey.trim();
            const prompt = document.getElementById('apiKeyPrompt');
            const refineBtn = document.getElementById('refineBtn');
            
            if (hasApiKey) {
                prompt.style.display = 'none';
                refineBtn.classList.remove('hidden');
            } else {
                prompt.style.display = 'block';
                refineBtn.classList.add('hidden');
            }
        }

        function saveApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            if (apiKey) {
                state.apiKey = apiKey;
                localStorage.setItem('openai_api_key', apiKey);
                updateApiKeyUI();
                hideModal('apiKeyModal');
                document.getElementById('apiKeyInput').value = '';
            }
        }

        function saveToLibrary() {
            const title = document.getElementById('promptTitle').value.trim();
            const prompt = document.getElementById('generatedPrompt').value.trim();
            
            if (!title || !prompt) {
                alert('Please enter a title and ensure you have a generated prompt');
                return;
            }

            const newPrompt = {
                id: Date.now(),
                title: title,
                prompt: prompt,
                personas: [...state.selectedPersonas],
                limitations: [...state.selectedLimitations],
                createdAt: new Date().toLocaleDateString()
            };

            state.promptLibrary.push(newPrompt);
            localStorage.setItem('promptLibrary', JSON.stringify(state.promptLibrary));
            document.getElementById('promptTitle').value = '';
            renderLibrary();
        }

        function renderLibrary() {
            const content = document.getElementById('libraryContent');
            
            if (state.promptLibrary.length === 0) {
                content.innerHTML = '<div class="empty-state">' +
                    '<div class="empty-icon">' +
                    '<i data-lucide="book-open" style="width: 64px; height: 64px; color: #64748b;"></i>' +
                    '</div>' +
                    '<p>No prompts found. Create your first prompt above!</p>' +
                    '</div>';
                lucide.createIcons();
                return;
            }

            let promptsHTML = '';
            for (let i = 0; i < state.promptLibrary.length; i++) {
                const prompt = state.promptLibrary[i];
                const safeTitle = prompt.title.replace(/</g, '&lt;').replace(/>/g, '&gt;');
                const safePreview = prompt.prompt.substring(0, 150).replace(/</g, '&lt;').replace(/>/g, '&gt;');
                
                promptsHTML += '<div class="prompt-card">';
                promptsHTML += '<h3 class="prompt-title">' + safeTitle + '</h3>';
                promptsHTML += '<p class="prompt-preview">' + safePreview + '...</p>';
                promptsHTML += '<div class="flex gap-2">';
                promptsHTML += '<button class="btn btn-primary" style="flex: 1; font-size: 0.875rem; padding: 0.5rem;" onclick="loadPrompt(' + prompt.id + ')">Load</button>';
                promptsHTML += '<button class="btn btn-secondary btn-small" onclick="copyPromptText(' + prompt.id + ')"><i data-lucide="copy" style="width: 16px; height: 16px;"></i></button>';
                promptsHTML += '<button class="btn btn-danger btn-small" onclick="deletePrompt(' + prompt.id + ')"><i data-lucide="trash-2" style="width: 16px; height: 16px;"></i></button>';
                promptsHTML += '</div>';
                promptsHTML += '</div>';
            }

            content.innerHTML = '<div class="prompt-grid">' + promptsHTML + '</div>';
            lucide.createIcons();
        }

        function loadPrompt(id) {
            const prompt = state.promptLibrary.find(p => p.id === id);
            if (prompt) {
                document.getElementById('generatedPrompt').value = prompt.prompt;
                
                // Reset checkboxes
                document.querySelectorAll('#personas-grid input[type="checkbox"]').forEach(cb => cb.checked = false);
                document.querySelectorAll('#limitations-grid input[type="checkbox"]').forEach(cb => cb.checked = false);
                
                // Set personas
                state.selectedPersonas = [...prompt.personas];
                prompt.personas.forEach(persona => {
                    const checkbox = document.querySelector('#personas-grid input[data-persona="' + persona + '"]');
                    if (checkbox) checkbox.checked = true;
                });

                // Set limitations
                state.selectedLimitations = [...prompt.limitations];
                prompt.limitations.forEach(limitation => {
                    const checkbox = document.querySelector('#limitations-grid input[data-limitation="' + limitation + '"]');
                    if (checkbox) checkbox.checked = true;
                });

                showOutput();
            }
        }

        function copyPromptText(id) {
            const prompt = state.promptLibrary.find(p => p.id === id);
            if (prompt) {
                copyToClipboard(prompt.prompt);
            }
        }

        function deletePrompt(id) {
            if (confirm('Are you sure you want to delete this prompt?')) {
                state.promptLibrary = state.promptLibrary.filter(p => p.id !== id);
                localStorage.setItem('promptLibrary', JSON.stringify(state.promptLibrary));
                renderLibrary();
            }
        }

        function launchWithAI() {
            const platform = document.getElementById('aiPlatform').value;
            const prompt = document.getElementById('generatedPrompt').value.trim();
            
            if (!prompt) {
                alert('Please generate a prompt first');
                return;
            }

            copyToClipboard(prompt);
            window.open(AI_PLATFORMS[platform], '_blank');
        }

        async function copyToClipboard(text) {
            try {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    await navigator.clipboard.writeText(text);
                } else {
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                }
            } catch (error) {
                console.error('Error copying to clipboard:', error);
            }
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        // Close modals when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                hideModal(e.target.id);
            }
        });
    </script>
</body>
</html>
